---
title: Patrones de Desarrollo API
description: Gu√≠a completa de patrones de desarrollo para endpoints REST en Orchestrator.
sidebar:
  label: Overview & Patterns
  order: 1
updated: 2026-01-03
---

import {
  Steps,
  Aside,
  Tabs,
  TabItem,
  Code,
  LinkCard,
  CardGrid,
  FileTree,
} from "@astrojs/starlight/components";

Este documento describe los **patrones arquitect√≥nicos** de la API. Para documentaci√≥n espec√≠fica de endpoints, navega a las secciones por dominio en el men√∫ lateral.

## Dominios API

<CardGrid>
  <LinkCard
    title="Command API"
    href="/api/endpoints/command/"
    description="Tenants, Auth, Users"
  />
  <LinkCard
    title="Remuneraciones API"
    href="/api/endpoints/remuneraciones/"
    description="Empleados, Contratos, N√≥mina"
  />
  <LinkCard
    title="Common API"
    href="/api/endpoints/common/"
    description="Indicadores, Par√°metros"
  />
</CardGrid>

---

## Arquitectura de Flujo de Solicitudes

El Orchestrator implementa una arquitectura estricta por capas donde cada capa tiene una responsabilidad espec√≠fica.

```mermaid
flowchart LR
    A[Solicitud HTTP]
    B[authenticateToken]
    C[getDatabaseNameForUser]
    D[getTenantPool]
    E[L√≥gica de Negocio]
    F[Manejador de Errores]
    G[Respuesta JSON]

    A --> B
    B -->|req.user poblado| C
    C -->|dbName| D
    D -->|pool| E

    E -->|√âxito| G
    E -->|Fallo| F
    F --> G
```

## Patr√≥n de Integraci√≥n Frontend

Sevastopol se integra con el Orchestrator usando un **patr√≥n de proxy simple**. Todas las rutas API en Sevastopol son proxies delgados que reenv√≠an solicitudes.

```mermaid
sequenceDiagram
    participant I as üèùÔ∏è SolidJS Island
    participant AF as üîê authenticatedFetch
    participant API as üì° API Astro
    participant PX as ‚ÜîÔ∏è createProxy
    participant O as üéØ Orchestrator

    I->>AF: fetch('/api/admin/chart-of-accounts')
    AF->>AF: Adjunta cookie sid
    AF->>API: HTTP request

    API->>PX: createProxy()
    PX->>O: Reenviar a :8000

    O-->>PX: JSON (snake_case)
    PX-->>API: Respuesta
    API-->>AF: JSON
    AF-->>I: Datos parseados
```

## Convenciones de Respuesta

<Aside type="tip" title="Convenci√≥n">
  Todas las respuestas de entidades de negocio usan `snake_case` para coincidir
  con los nombres de columnas de la base de datos. Esto **elimina la necesidad
  de transformaci√≥n** en el frontend.
</Aside>

### Matriz de C√≥digos de Estado

| C√≥digo | Caso de Uso      | Ejemplo                        |
| ------ | ---------------- | ------------------------------ |
| `200`  | GET/PUT exitoso  | Recurso obtenido o actualizado |
| `201`  | POST exitoso     | Recurso creado                 |
| `204`  | DELETE exitoso   | Recurso eliminado (sin cuerpo) |
| `400`  | Entrada inv√°lida | Campos requeridos faltantes    |
| `401`  | No autorizado    | Sin token o token inv√°lido     |
| `403`  | Prohibido        | Token v√°lido pero sin permisos |
| `404`  | No encontrado    | El recurso no existe           |
| `409`  | Conflicto        | Recurso duplicado              |
| `500`  | Error interno    | Error de base de datos         |
