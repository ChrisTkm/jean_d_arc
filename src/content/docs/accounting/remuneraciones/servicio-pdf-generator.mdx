---
title: Generaci√≥n Documental (PDF Service)
description: Arquitectura centralizada para la emisi√≥n de documentos legales y tributarios en formato PDF.
sidebar:
  label: üñ®Ô∏è Motor PDF
  order: 99
updated: 2026-01-05
---

import {
  Steps,
  FileTree,
  LinkCard,
  CardGrid,
} from "@astrojs/starlight/components";

El sistema utiliza un motor de generaci√≥n documental unificado (`PdfService`) que garantiza consistencia visual, validez legal y trazabilidad en todos los documentos emitidos (Liquidaciones, Contratos, Finiquitos).

## Arquitectura de Generaci√≥n

El proceso sigue un patr√≥n estricto de **Separaci√≥n de Responsabilidades** para desacoplar los datos de la presentaci√≥n visual.

```mermaid
flowchart LR
    Data[Datos de Negocio] --> Service[Domain Service]
    Service -->|Context Object| Generator[HtmlGenerator]
    Generator -->|HTML String| PDF[PdfService (Puppeteer)]
    PDF -->|Buffer/Stream| Storage[File System / S3]
    Storage -->|URL| UI[Cliente / Browser]
```

### Componentes Clave

1.  **Domain Service** (`ContractService`, `FiniquitoService`): Recopila datos de m√∫ltiples fuentes (Empleado, Empresa, C√°lculos) y construye un **Contexto de Datos** seguro y tipado.
2.  **HtmlGenerator**: Plantillas TypeScript que reciben el Contexto y generan HTML puro con estilos embebidos (CSS). No contienen l√≥gica de negocio, solo de presentaci√≥n.
3.  **PdfService**: Wrapper sobre `puppeteer` (headless Chrome) que renderiza el HTML a PDF con configuraciones de papel y m√°rgenes est√°ndar (Carta / A4).

## Documentos Soportados

El motor alimenta los siguientes subsistemas documentales:

<CardGrid>
  <LinkCard
    title="üìú Contratos Laborales"
    href="/accounting/remuneraciones/servicio-contratos/"
    description="Contratos indefinidos y plazo fijo con cl√°usulas din√°micas de Jornada."
  />
  <LinkCard
    title="üí∞ Liquidaciones de Sueldo"
    href="/accounting/remuneraciones/servicio-liquidaciones/"
    description="Comprobantes de pago mensual con detalle de haberes y descuentos."
  />
  <LinkCard
    title="‚öñÔ∏è Finiquitos (Art. 177)"
    href="/accounting/remuneraciones/servicio-finiquitos/"
    description="Documentos de t√©rmino de relaci√≥n laboral con poder liberatorio."
  />
</CardGrid>

## Patrones de Dise√±o

### 1. Compliance Infalible üõ°Ô∏è

El generador no es solo un "impresor". Act√∫a como una **Barrera de Compliance**.
Si los datos del empleado (ej: AFP, Salud) o del contrato (ej: Jornada) no son v√°lidos seg√∫n la normativa laboral, el sistema **bloquea la generaci√≥n** y reporta el error. Esto previene la emisi√≥n de documentos legales nulos o defectuosos.

### 2. Self-Healing & Regeneraci√≥n üîÑ

Los documentos no son est√°ticos. El sistema implementa **Regeneraci√≥n On-Demand**:

- Si un archivo f√≠sico se pierde o da√±a, el endpoint de descarga detecta la ausencia y lo regenera al vuelo usando los datos actuales.
- Permite forzar la regeneraci√≥n (`?force=true`) para reflejar correcciones de √∫ltima hora (ej: correcci√≥n de error tipogr√°fico en nombre) sin ensuciar la base de datos con versiones obsoletas.

### 3. Seguridad de Sesi√≥n

La descarga de documentos utiliza la sesi√≥n autenticada del navegador (cookies `HttpOnly`), asegurando que solo usuarios con permisos activos puedan acceder a los archivos sensibles protegidos por leyes de privacidad.

## Est√°ndares Visuales

- **Tipograf√≠a**: Open Sans (Cuerpo) y Merriweather (T√≠tulos Legales).
- **Papel**: Carta (Letter) con m√°rgenes de 2.5cm.
- **Elementos Gr√°ficos**: Solo tablas y l√≠neas simples para m√°xima compatibilidad y sobriedad legal. No se utilizan im√°genes pesadas ni colores que no impriman bien en blanco y negro.
